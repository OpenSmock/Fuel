<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Upgrading Fuel # Each Fuel version has its own stream format. Furthermore, each version is considered incompatible with other versions. In Fuel 5 this requirement was changed, such that all versions with the same major version are considered compatible.
This means, in general, that when upgrading Fuel, we will need to convert our serialized streams.
Notes
We assume in these examples that the number of objects to migrate can be materialized all at the same time, which might not be possible in practice."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Upgrading Fuel # Each Fuel version has its own stream format. Furthermore, each version is considered incompatible with other versions. In Fuel 5 this requirement was changed, such that all versions with the same major version are considered compatible.
This means, in general, that when upgrading Fuel, we will need to convert our serialized streams.
Notes
We assume in these examples that the number of objects to migrate can be materialized all at the same time, which might not be possible in practice."><meta property="og:type" content="article"><meta property="og:url" content="https://theseion.github.io/Fuel/upgrading/"><meta property="article:section" content><meta property="article:modified_time" content="2024-01-20T19:41:22+01:00"><title>Upgrading | Fuel</title>
<link rel=manifest href=/Fuel/manifest.json><link rel=icon href=/Fuel/favicon.png type=image/x-icon><link rel=stylesheet href=/Fuel/book.min.4161ce72491bec8afb94acd3b81e1480e4774aca5e9e3e25c4eeeb0a4dff856a.css integrity="sha256-QWHOckkb7Ir7lKzTuB4UgOR3Sspenj4lxO7rCk3/hWo=" crossorigin=anonymous><script defer src=/Fuel/flexsearch.min.js></script><script defer src=/Fuel/en.search.min.d76f6c379e85b31a856bda08c54d4eb7a1de3245310309f70532b701ebdf9eec.js integrity="sha256-129sN56FsxqFa9oIxU1Ot6HeMkUxAwn3BTK3Aevfnuw=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/Fuel/><img src=/Fuel/logo-fuel-header.png alt=Logo><span>Fuel</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://theseion.github.io/Fuel/builtin-header-support/>Builtin Header Support</a></li><li><a href=https://theseion.github.io/Fuel/customizing-the-graph/>Customizing the Graph</a></li><li><a href=https://theseion.github.io/Fuel/debugging/>Debugging</a></li><li><a href=https://theseion.github.io/Fuel/errors/>Errors</a></li><li><a href=https://theseion.github.io/Fuel/managing-globals/>Managing Globals</a></li><li><a href=https://theseion.github.io/Fuel/migration/>Migration</a></li><li><a href=https://theseion.github.io/Fuel/package-overview/>Package Overview</a></li><li><a href=https://theseion.github.io/Fuel/upgrading/ class=active>Upgrading</a></li><li><span>Releases</span><ul><li><a href=https://theseion.github.io/Fuel/releases/5.2.2/>5.2.2</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.2.1/>5.2.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.2.0/>5.2.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.1.0/>5.1.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.6/>5.0.6</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.5/>5.0.5</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.3/>5.0.3</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.4/>5.0.4</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.2/>5.0.2</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.1/>5.0.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/5.0.0/>5.0.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/4.1.1/>4.1.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/4.1.0/>4.1.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/4.0.0/>4.0.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/3.0.0/>3.0.0</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.9.3/>1.9.3</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.9/>1.9</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.8/>1.8</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.8.1/>1.8.1</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.7/>1.7</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.6/>1.6</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.5/>1.5</a></li><li><a href=https://theseion.github.io/Fuel/releases/1.4/>1.4</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/Fuel/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Upgrading</strong>
<label for=toc-control><img src=/Fuel/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#considerations>Considerations</a></li></ul></nav></aside></header><article class=markdown><h1 id=upgrading-fuel>Upgrading Fuel
<a class=anchor href=#upgrading-fuel>#</a></h1><p>Each Fuel version has its own stream format. Furthermore, each version is considered incompatible with other versions. In Fuel 5 this requirement was changed, such that all versions with the same major version are considered compatible.</p><p>This means, in general, that when upgrading Fuel, we will need to convert our serialized streams.</p><p><strong>Notes</strong></p><ol><li>We assume in these examples that the number of objects to migrate can be materialized all at the same time, which might not be possible in practice. In such a case, the script could split the list of files and perform the migration in batches.</li><li>It is necessary to fetch the materializer class dynamically after the desired Fuel version has been loaded. The binding of a static class reference might be stale and point to an old version of the class instead of the newly installed one.</li><li>This script should be evaluated in the original image, as versions are usually backwards-compatible, but not vice-versa.</li></ol><p>Let&rsquo;s say, we have some files serialized with Fuel 3.0.0 and we want to migrate them to Fuel 3.0.3. The following example works in Pharo 8:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-smalltalk data-lang=smalltalk><span style=display:flex><span><span style=color:#f92672>|</span> oldVersion newVersion fileNames objectsByFileName materializerClass serializerClass <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>oldVersion <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#39;3.0.0&#39;</span>.
</span></span><span style=display:flex><span>newVersion <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#39;3.0.3&#39;</span>.
</span></span><span style=display:flex><span>fileNames <span style=color:#f92672>:=</span> <span style=color:#e6db74>#(</span><span style=color:#e6db74>&#39;a.fuel&#39;</span> <span style=color:#e6db74>&#39;b.fuel&#39;</span> <span style=color:#e6db74>&#39;c.fuel&#39;</span> <span style=color:#e6db74>&#39;d.fuel&#39;</span> <span style=color:#e6db74>&#39;e.fuel&#39;</span><span style=color:#e6db74>)</span>.
</span></span><span style=display:flex><span>objectsByFileName <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Dictionary</span> new.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>materializerClass <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Smalltalk</span> <span style=color:#a6e22e>at:</span> <span style=color:#e6db74>#FLMaterializer</span>.
</span></span><span style=display:flex><span>fileNames <span style=color:#a6e22e>do:</span> [ <span style=color:#f92672>:</span>fileName <span style=color:#f92672>|</span> 
</span></span><span style=display:flex><span>	objectsByFileName 
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>at:</span> fileName 
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>put:</span> (materializerClass <span style=color:#a6e22e>materializeFromFileNamed:</span> fileName) ].
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Metacello</span> new
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>repository:</span> <span style=color:#e6db74>&#39;github://theseion/Fuel:3.0.3/repository&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>baseline:</span> <span style=color:#e6db74>&#39;Fuel&#39;</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>onConflictUseIncoming</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>load</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>serializerClass <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Smalltalk</span> <span style=color:#a6e22e>at:</span> <span style=color:#e6db74>#FLSerializer</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>objectsByFileName <span style=color:#a6e22e>keysAndValuesDo:</span> [ <span style=color:#f92672>:</span>fileName <span style=color:#f92672>:</span>objects <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>	serializerClass 
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>serialize:</span> objects  
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>toFileNamed:</span> <span style=color:#e6db74>&#39;migrated-&#39;</span><span style=color:#a6e22e>,</span> fileName
</span></span><span style=display:flex><span>	 ].
</span></span></code></pre></div><h2 id=considerations>Considerations
<a class=anchor href=#considerations>#</a></h2><p>We know that it is possible to upgrade from Fuel 3.0.3 to Fuel 5.2.2 directly, using the method detailed above. However, due to the nature of Fuel and changes to the internal objects across different versions of Fuel and Squeak, we cannot guarantee that this will work for everyone. For example, Fuel version 5 has no concept of <code>BlockContext</code>, because it was renamed to <code>Context</code> in later versions. Hence, Fuel 5 in Pharo 8 will not be able to serialize <code>BlockContext</code>.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/theseion/Fuel/commit/412ef093b2aed063b9293ca8d16ede33737b726e title='Last modified by Max Leske | Jan 20, 2024' target=_blank rel=noopener><img src=/Fuel/svg/calendar.svg class=book-icon alt=Calendar>
<span>Jan 20, 2024</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#considerations>Considerations</a></li></ul></nav></div></aside></main></body></html>